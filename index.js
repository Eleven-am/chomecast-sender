(()=>{"use strict";var e={};(()=>{e.d=(t,i)=>{for(var s in i){if(e.o(i,s)&&!e.o(t,s)){Object.defineProperty(t,s,{enumerable:true,get:i[s]})}}}})();(()=>{e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})();(()=>{e.r=e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}})();if(typeof e!=="undefined")e.ab=__dirname+"/";var t={};e.r(t);e.d(t,{CastEventType:()=>s,default:()=>Cast});var i=undefined&&undefined.__awaiter||function(e,t,i,s){function adopt(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,n){function fulfilled(e){try{step(s.next(e))}catch(e){n(e)}}function rejected(e){try{step(s["throw"](e))}catch(e){n(e)}}function step(e){e.done?i(e.value):adopt(e.value).then(fulfilled,rejected)}step((s=s.apply(e,t||[])).next())}))};const s={ERROR:"error",AVAILABLE:"available",PAUSED:"paused",CONNECT:"connect",MUTED:"muted",DISCONNECT:"disconnect",NAMESPACE:"namespace",END:"end",PLAYING:"playing",BUFFERING:"buffering",DURATIONCHANGE:"durationChanged",TIMEUPDATE:"timeupdate",VOLUMECHANGE:"volumechange"};class Cast{constructor(e,t){this.available=false;this.muted=false;this.paused=false;this.device="";this.src="";this.timePretty="";this.durationPretty="";this.state="";this.time=1;this.volumeLevel=1;this.duration=1;this.progress=1;if(typeof window!==undefined&&window.chrome&&!window.chrome.cast){let e=document.createElement("script");e.src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1";document.head.appendChild(e)}this.events={};this.player=null;this.castSession=null;this.connected=false;this.device="";this.receiverApplicationId=e;this.namespace=t||"urn:x-cast:com.custom.cast";this.reset();this.init()}on(e,t){if(!this.events[e])this.events[e]=[];this.events[e].push(t)}off(e,t){if(!this.events[e])throw new Error(`Can't remove a listener. Event "${e}" doesn't exits.`);this.events[e]=this.events[e].filter((e=>e!==t))}playPause(){var e;(e=this.controller)===null||e===void 0?void 0:e.playOrPause();return this}muteUnmute(){var e;(e=this.controller)===null||e===void 0?void 0:e.muteOrUnmute();this.muted=!this.muted;return this}seek(e){var t;if(this.player)this.player.currentTime=e;(t=this.controller)===null||t===void 0?void 0:t.seek();return this}volume(e){var t;if(this.player)this.player.volumeLevel=this.volumeLevel=e;(t=this.controller)===null||t===void 0?void 0:t.setVolumeLevel();this.volumeLevel=e;return this}send(e){return i(this,void 0,void 0,(function*(){if(this.connected&&this.castSession)yield this.castSession.sendMessage(this.namespace,e)}))}castMedia(e,t){var i;this.src=e.src;let n=new chrome.cast.media.MediaInfo(this.src,"video/mp4");n.metadata=new chrome.cast.media.GenericMediaMetadata;if(t)n.customData=t;let a=new chrome.cast.media.LoadRequest(n);a.currentTime=e.currentTime;a.autoplay=!e.paused;(i=cast.framework.CastContext.getInstance().getCurrentSession())===null||i===void 0?void 0:i.loadMedia(a).then((()=>{var t;this.device=((t=cast.framework.CastContext.getInstance().getCurrentSession())===null||t===void 0?void 0:t.getCastDevice().friendlyName)||this.device;this.volume(e.volume);return this}),(e=>this.emit(s.ERROR,Object.assign(Object.assign({},this.buildEvent()),{error:e}))))}connect(){cast.framework.CastContext.getInstance().requestSession().then((()=>{if(!cast.framework.CastContext.getInstance().getCurrentSession())return this.emit(s.ERROR,Object.assign(Object.assign({},this.buildEvent()),{error:{error:"Could not connect with the cast device"}}));return this.emit(s.CONNECT,this.buildEvent())})).catch((e=>{this.emit(s.ERROR,e)}))}disconnect(){var e;this.connected=false;this.emit(s.DISCONNECT,this.buildEvent());cast.framework.CastContext.getInstance().endCurrentSession(true);(e=this.controller)===null||e===void 0?void 0:e.stop();this.device="";this.reset();return this}reset(){this.src="";this.volumeLevel=1;this.muted=false;this.paused=false;this.time=0;this.timePretty="00:00:00";this.duration=0;this.durationPretty="00:00:00";this.progress=0;this.state="disconnected"}emit(e,t){var i;if(!this.events[e])console.error(`Can't find a listener. Event "${e}" doesn't exits.`);const fireCallbacks=e=>{e(t)};(i=this.events[e])===null||i===void 0?void 0:i.forEach(fireCallbacks)}buildState(){var e,t,i,s,n;this.time=Math.round(((e=this.player)===null||e===void 0?void 0:e.currentTime)||0);this.duration=((t=this.player)===null||t===void 0?void 0:t.duration)||0;this.progress=((i=this.controller)===null||i===void 0?void 0:i.getSeekPosition(this.time,this.duration))||0;this.timePretty=((s=this.controller)===null||s===void 0?void 0:s.getFormattedTime(this.time))||this.timePretty;this.durationPretty=((n=this.controller)===null||n===void 0?void 0:n.getFormattedTime(this.duration))||this.durationPretty;return{time:this.time,timePretty:this.timePretty,durationPretty:this.durationPretty,duration:this.duration,progress:this.progress}}buildEvent(){return{buffering:false,available:this.available,connected:this.connected,volume:this.volumeLevel,paused:this.paused,muted:this.muted,end:false,device:this.device,error:null,state:this.buildState()}}init(e=0){if(!window.chrome||!window.chrome.cast||!window.chrome.cast.isAvailable){if(e>20)this.emit(s.AVAILABLE,Object.assign(Object.assign({},this.buildEvent()),{available:false}));else setTimeout((()=>{this.init(e++)}),250)}else{cast.framework.CastContext.getInstance().setOptions({receiverApplicationId:this.receiverApplicationId,autoJoinPolicy:chrome.cast.AutoJoinPolicy.TAB_AND_ORIGIN_SCOPED,language:"en-US",resumeSavedSession:false});this.player=new cast.framework.RemotePlayer;this.controller=new cast.framework.RemotePlayerController(this.player);this.controller.addEventListener(cast.framework.RemotePlayerEventType.IS_CONNECTED_CHANGED,this.isConnectedChanged.bind(this));this.controller.addEventListener(cast.framework.RemotePlayerEventType.IS_MUTED_CHANGED,this.isMutedChanged.bind(this));this.controller.addEventListener(cast.framework.RemotePlayerEventType.IS_PAUSED_CHANGED,this.isPausedChanged.bind(this));this.controller.addEventListener(cast.framework.RemotePlayerEventType.CURRENT_TIME_CHANGED,this.currentTimeChanged.bind(this));this.controller.addEventListener(cast.framework.RemotePlayerEventType.DURATION_CHANGED,this.durationChanged.bind(this));this.controller.addEventListener(cast.framework.RemotePlayerEventType.VOLUME_LEVEL_CHANGED,this.volumeLevelChanged.bind(this));this.controller.addEventListener(cast.framework.RemotePlayerEventType.PLAYER_STATE_CHANGED,this.playerStateChanged.bind(this));this.emit(s.AVAILABLE,Object.assign(Object.assign({},this.buildEvent()),{available:true}));this.available=true}}isConnectedChanged(){var e,t;this.connected=((e=this.player)===null||e===void 0?void 0:e.isConnected)||false;if(this.connected){this.castSession=cast.framework.CastContext.getInstance().getCurrentSession();this.device=((t=cast.framework.CastContext.getInstance().getCurrentSession())===null||t===void 0?void 0:t.getCastDevice().friendlyName)||this.device;if(this.castSession)this.castSession.addMessageListener(this.namespace,((e,t)=>{this.emit(s.NAMESPACE,Object.assign(Object.assign({},this.buildEvent()),{namespaceResponse:t}))}))}this.state=!this.connected?"disconnected":"connected";this.emit(this.state==="connected"?s.CONNECT:s.DISCONNECT,this.buildEvent())}isMutedChanged(){var e;const t=this.muted;this.muted=((e=this.player)===null||e===void 0?void 0:e.isMuted)||false;if(t!==this.muted)this.emit(s.MUTED,this.buildEvent())}isPausedChanged(){var e;this.paused=((e=this.player)===null||e===void 0?void 0:e.isPaused)||false;this.emit(s.PAUSED,this.buildEvent())}playerStateChanged(){var e,t,i,n;this.connected=((e=this.player)===null||e===void 0?void 0:e.isConnected)||false;if(!this.connected)this.emit(s.DISCONNECT,this.buildEvent());const a=this.buildEvent();this.device=((t=cast.framework.CastContext.getInstance().getCurrentSession())===null||t===void 0?void 0:t.getCastDevice().friendlyName)||this.device;this.state=((n=(i=this.player)===null||i===void 0?void 0:i.playerState)===null||n===void 0?void 0:n.toLowerCase())||"";switch(this.state){case"idle":this.state="ended";this.emit(s.END,Object.assign(Object.assign({},this.buildEvent()),{end:true}));break;case"buffering":this.emit(s.BUFFERING,Object.assign(Object.assign({},a),{buffering:true}));break;case"playing":setTimeout((()=>{this.emit(s.PLAYING,a)}));break}}durationChanged(){var e;this.duration=((e=this.player)===null||e===void 0?void 0:e.duration)||this.duration;this.emit(s.DURATIONCHANGE,this.buildEvent())}currentTimeChanged(){const e=this.buildEvent();this.emit(s.TIMEUPDATE,e)}volumeLevelChanged(){var e,t;this.volumeLevel=Number((((e=this.player)===null||e===void 0?void 0:e.volumeLevel)||this.volumeLevel).toFixed(1));if((t=this.player)===null||t===void 0?void 0:t.isMediaLoaded)this.emit(s.VOLUMECHANGE,this.buildEvent())}}module.exports=t})();